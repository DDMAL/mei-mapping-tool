
doctype html
html
  head
   link(href='https://fonts.googleapis.com/icon?family=Material+Icons', rel='stylesheet')
   script(src='/ace-builds/src-noconflict/ace.js', type='text/javascript', charset='utf-8')
  script(src='https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js')
  link(href='https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.4.0/dropzone.css', type='text/css', rel='stylesheet')
  script(src='https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.4.0/dropzone.js', type='text/javascript')

   script(src='/javascripts/dropzone.js')
   link(rel='stylesheet', href='/stylesheets/dropzone.css')
   script(type='text/javascript' src='/javascripts/ace.js')
   link(rel='stylesheet', href='https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/css/materialize.min.css')
   link(rel='stylesheet', href='/stylesheets/style.css')
   link(rel='stylesheet', href='/stylesheets/column.css')
   link(rel='stylesheet', href='/stylesheets/collapsible.css')
   meta(name='viewport', content='width=device-width, initial-scale=1.0')
   script(src='https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js')
   link(href='https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.4.0/dropzone.css', type='text/css', rel='stylesheet')
   script(src='https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.4.0/dropzone.js', type='text/javascript')
   script(src='https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js')
   link(href='/stylesheets/dropzone.css', type='text/css', rel='stylesheet')
   script(src='/javascripts/dropzone.js', type='text/javascript')
   script(src='/javascripts/worker-html.js', type='text/javascript')
   style(type='text/css', media='screen').
      #editor {
      height: 120px;
      width : 500px;
      }
   style(type='text/css', media='screen').
      #editor2{
      height: 120px;
      width : 100%;
      }

body
    h1.
         #{title} 
    a#addingNeume(href='/projects/neumes/new') Add neume
    br
    button#logging-out(type='button', href='/logout') Logout
    ul
        - each neume, i in neumes
          
            button.collapsible #{neume.name}
               form(action='/neume/#{neume._id}/edit',method='post',enctype='application/x-www-form-urlencoded')
                    input(type='hidden',value='DELETE',name='_method')
                    button(type='submit').
                        Delete
            form(action='/neume/#{neume._id}/edit',method='post',name='updateneume',enctype='application/x-www-form-urlencoded')
                .column
                   .card
                     .panel.panel-default
                       .panel-body
                          div(id = "#{neume.name}")
                            p Images: 
                .column
                   .card 
                    h6 Name: 
                    input#inputName(type='text', value='#{neume.name}', name='name' required)
                    br
                    h6 Folio:
                     input#inputfolio(type='text', value='#{neume.folio}', name='folio')
                    br
                    h6 Description:
                    input#inputDescription(type='text', value='#{neume.description}', name='description')

                .column
                   .card 
                    p Classification: 
                    input#inputClassification(type='text',value='#{neume.classification}', name='classification')
                .column
                   .card 
                    p Mei Snippet: 
                       .panel.panel-default
                        .panel-body
                             div(id = "#{neume.id}")
                               p 
                            textarea#inputMei(name='mei', value='#{neume.mei}' style='display: none;')


                input(type='hidden',value='PUT',name='_method')
                button#btnSubmit(type='submit', value = 'update' href = "/neumes") Update
                script(src='https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js')
                script(src='/ace-builds/src-noconflict/ace.js', type='text/javascript', charset='utf-8')
                
                script.
                  console.log('hey');
                  //for each neume in the mei snippet : 
                  var editor2 = ace.edit('#{neume.id}');
                  var textarea = $('textarea[name="mei"]');
                    editor2.getSession().on("change", function () {
                      textarea.val(editor2.getSession().getValue());
                      localStorage.setItem("ace",textarea.val());
                    });
                  editor2.setTheme("ace/theme/monokai");
                  editor2.session.setMode("ace/mode/xml");
                   var aceEditor = localStorage.getItem('ace');

                  //Getting the canvas for the mei snippets : 
                  var imagePaths = "#{neume.imagePath}";
                  var imageArray = imagePaths.split(',');
                  imageArray.forEach(function(element){
                  var canvas = document.createElement('canvas');
                  var ctx = canvas.getContext("2d");
                  var image = new Image();

                  image.onload = function () {

                      // set size proportional to image
                      canvas.height = 95;
                      canvas.width = 100;

                      // step 1 - resize to 50%
                      var oc = document.createElement('canvas'),
                          octx = oc.getContext('2d');

                      oc.width = image.width;
                      oc.height = image.height;
                      octx.drawImage(image, 0, 0, oc.width, oc.height);

                      // step 2
                      octx.drawImage(oc, 0, 0, oc.width, oc.height);

                      // step 3, resize to final size
                      ctx.drawImage(oc, 0, 0, oc.width, oc.height,
                      0, 0, canvas.width, canvas.height);
                  }
                  image.src = "/gallery/" + element; //getting the file paths
                  var imageCard = document.getElementById("#{neume.id}");//getting
                  imageCard.appendChild(canvas);
                  canvas.appendChild(image);//the image is appended
                  });


                  var imagePaths = "#{neume.imagePath}";
                  var imageArray = imagePaths.split(',');
                  //console.log(imageArray);
                  imageArray.forEach(function(element) {
                  var canvas = document.createElement('canvas');
                  var ctx = canvas.getContext("2d");
                  var image = new Image();

                  image.onload = function () {

                      // set size proportional to image
                      canvas.height = 60;
                      canvas.width = 60;

                      // step 1 - resize to 50%
                      var oc = document.createElement('canvas'),
                          octx = oc.getContext('2d');

                      oc.width = image.width;
                      oc.height = image.height;
                      octx.drawImage(image, 0, 0, oc.width, oc.height);

                      // step 2
                      octx.drawImage(oc, 0, 0, oc.width, oc.height);

                      // step 3, resize to final size
                      ctx.drawImage(oc, 0, 0, oc.width, oc.height,
                      0, 0, canvas.width, canvas.height);
                  }
                  image.src = "/gallery/" + element; //getting the file paths
                  var imageCard = document.getElementById("#{neume.name}");//getting
                  imageCard.appendChild(canvas);
                  canvas.appendChild(image);//the image is appended
                  });
