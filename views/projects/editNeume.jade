block content
    h5.
      #{neume.name}
    form(action='/neumes/#{neume._id}/editImage',method='post',name='updateneume',enctype='application/x-www-form-urlencoded')
        div(id = "dropzone#{neume.id}").dropzone(method='post', action='/image' name="image" required)
        .fallback
        p Images :
        input(type="text", name="imageDeleted" id = "imageToDelete#{neume.id}" hidden)
        div(id = "images#{neume.id}")
          input(type='hidden',value='PUT',name='_method') 
          button#btnSubmit(type="submit") submit
    
    form(action='/neumes/#{neume._id}/editImage',method='post',enctype='application/x-www-form-urlencoded' id = "DeleteImageForm")
              input(type='hidden',value='DELETE',name='_method')
              button#submitImageDeleted(type="submit" hidden) submit
      
script.
  Dropzone.autoDiscover = false;
  if (document.getElementById('dropzone#{neume.id}')) {
    var myDropzone = new Dropzone("div#dropzone#{neume.id}", {
        maxFileSize: 100,
        acceptedFiles: ".png, .jpg, .tiff, .tif, .jpeg",
        addRemoveLinks: true,
    });
    }
    myDropzone.on('removedfile', function (file) {
    //Need to add the remove file to true from the dropzone.
        var fs = require('fs');
          console.log(file);

        /* here do AJAX call to your server ... */
        //try an ajax call with a php file
        });
    //Getting the canvas for the mei snippets : 
                  var imagePaths = "#{neume.imagePath}";
                  var imageArray = imagePaths.split(',');
              
              //For each image in the neume
              imageArray.forEach(function(element){
                  //creating a canvas
                  var canvas = document.createElement('canvas');
                  var ctx = canvas.getContext("2d");
                  //creating an image object
                  var image = new Image();

                  image.onload = function () {

                      // set size proportional to image
                      canvas.height = 95;
                      canvas.width = 100;

                      // step 1 - resize to 50%
                      var oc = document.createElement('canvas'),
                          octx = oc.getContext('2d');

                      oc.width = image.width;
                      oc.height = image.height;
                      octx.drawImage(image, 0, 0, oc.width, oc.height);

                      // step 2
                      octx.drawImage(oc, 0, 0, oc.width, oc.height);

                      // step 3, resize to final size
                      ctx.drawImage(oc, 0, 0, oc.width, oc.height,
                      0, 0, canvas.width, canvas.height);
                  }
                  //getting the source of the image from the gallery
                  image.src = "/gallery/" + element; //getting the file paths

                  //This seems to be undefined. 
                  var div = document.getElementById("imageDeleted");
                  var imageDeletedPath = document.getElementById("imageToDelete#{neume.id}");
                  imageDeletedPath.value = element;
                  imageDeletedPath.name = "imageDeleted";
                  imageDeletedPath.hidden = true;
                  
                  var imageCard = document.getElementById("images#{neume.id}");//getting
                  //add the image to the canvas
                  imageCard.appendChild(imageDeletedPath);
                  imageCard.appendChild(canvas);
                  console.log(imageCard); //This is appended
                  canvas.appendChild(image);//the image is appended

                  //We can create a delete button here 
                  var button = document.createElement("BUTTON");
                  button.className = "button button3";
                  button.innerHTML = "x";
                  button.onclick = function Function(){
                    var submitImageDeletedForm = document.getElementById("submitImageDeleted");
                    submitImageDeleteForm.click();
                    //Check javascript value for code. 

                  }
                  
                  imageCard.appendChild(button);
                  //We also append it to the input element from the form
                  });

